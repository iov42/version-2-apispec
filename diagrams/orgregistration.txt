title Org Registration

actor User
participant "Web App" as WA
participant "App Service" as AS
database Store
materialdesignicons F01F0 email

User-->WA: Enters details into Registration Page.\n Capture's user info and org info.

WA->AS: POST /registrations
activate AS
box over WA,AS:{\n"regType: "Org",\n "firstName": "First",\n "lastName" : "Last",\n "Last" : "first.last@someorg.com",\n "password": "e7cf3ef4f17c3999a",\n "organisation" : "Some Org",\n "country": "BE"\n}
AS->Store: Create Organisation Resource\n(Status: PENDING)
AS->Store: Create User Resource\n(Status: PENDING)
AS->Store: Create Registration Resource\n(Status: PENDING_VERIFICATION)
box over AS,Store: id="1234"\nstatus= "AWAITING_VERIFICATION"\nemail= "first.last@someorg.com"\ntoken=4324321fflk

AS->AS: Generate verification link
AS-->User:Send verification email

box over AS, User: https://...?t=4324321fflk

AS->WA:
box over WA, AS: {\n"id" : "1234",\n "status": "AWAITING_VERIFICATION"\n}

WA->AS: GET /registrations/1234
AS->WA: 
box over WA, AS: {\n"id" : "1234",\n "status": "AWAITING_VERIFICATION"\n}